# Compaction Request Schema
# Validates input to all compact-* skills

type: object
required:
  - target

properties:
  target:
    type: object
    required:
      - type
      - identifier
    properties:
      type:
        type: string
        enum: [file, block, artifact, message_range]
        description: Type of context target
      identifier:
        type: string
        description: Unique identifier for the target

  preserve:
    type: array
    items:
      type: string
      enum:
        - decisions
        - constraints
        - named_entities
        - rationale
        - open_questions
        - normative_language
    default:
      - decisions
      - constraints
      - named_entities

  discard:
    type: array
    items:
      type: string
      enum:
        - exploration
        - repetition
        - abandoned_alternatives
        - verbose_rationale

  schema:
    type: string
    description: Schema ID for output validation

# Auto-mode only constraints
auto_constraints:
  type: object
  properties:
    max_loss:
      type: string
      enum: [low, medium, high]
      default: low
    prefer:
      type: array
      items:
        type: string
        enum: [recoverability, authority]
    forbid:
      type: array
      items:
        type: string
        enum: [rationale_removal, entity_merging, language_normalization]
